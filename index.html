<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AI-–ö–æ—Å—Ç—ë—Ä üî•</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0b0e14;color:#e5e7eb}
    .container{display:grid;grid-template-columns:360px 1fr;gap:16px;padding:16px;max-width:1100px;margin:auto}
    .panel,.scene{background:#111526dd;border:1px solid #263043;border-radius:16px;padding:18px}
    .scene{position:relative;aspect-ratio:1/1;min-height:520px;overflow:hidden}
    textarea{width:100%;min-height:120px;background:#0f1420;color:#e5e7eb}
    button{margin-top:6px;margin-right:6px;padding:10px 14px;border-radius:10px;font-weight:700}
    .start{background:#10b981}.stop{background:#ef4444;color:#fff}.reset{background:#334155;color:#e5e7eb}
    .names-circle{position:absolute;inset:0}
    .name-pill{position:absolute;transform:translate(-50%,-50%);padding:6px 10px;border-radius:999px;background:#222}
    .name-active{background:#ffd166;color:#000}
    .flame{display:none;width:140px;height:160px;margin:auto;position:relative}
    .flame span{position:absolute;bottom:0;left:50%;transform:translateX(-50%);border-radius:50%;animation:flicker 1s infinite alternate}
    .f1{width:120px;height:140px;background:orange;animation-duration:1.4s}
    .f2{width:90px;height:110px;background:gold;animation-duration:1.1s}
    .f3{width:60px;height:90px;background:#fff;animation-duration:.9s}
    @keyframes flicker{0%{opacity:1}50%{opacity:.6}100%{opacity:1}}
    @media(max-width:768px){.container{grid-template-columns:1fr}.scene{min-height:420px}}
  </style>
</head>
<body>
<div class="container">
  <div class="panel">
    <h1>AI-–ö–æ—Å—Ç—ë—Ä üî•</h1>
    <textarea id="namesInput" placeholder="–í–≤–µ–¥–∏ –∏–º–µ–Ω–∞ –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É"></textarea><br>
    <button id="toggleBtn" class="start">–ü—É—Å–∫</button>
    <button id="resetBtn" class="reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <div id="eveningAward">üèÜ –°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤–µ—á–µ—Ä–∞: ‚Äî</div>
  </div>
  <div class="scene" id="scene">
    <div class="names-circle" id="namesCircle"></div>
    <div class="flame" id="flame"><span class="f1"></span><span class="f2"></span><span class="f3"></span></div>
    <div id="smokeLabel">üî• –°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞</div>
    <canvas id="smokeCanvas"></canvas>
  </div>
</div>

<script>
(function(){
  var namesInput=document.getElementById('namesInput');
  var namesCircle=document.getElementById('namesCircle');
  var smokeLabel=document.getElementById('smokeLabel');
  var eveningAward=document.getElementById('eveningAward');
  var toggleBtn=document.getElementById('toggleBtn');
  var resetBtn=document.getElementById('resetBtn');
  var flame=document.getElementById('flame');
  var scene=document.getElementById('scene');
  var canvas=document.getElementById('smokeCanvas');
  var ctx=canvas.getContext('2d');

  var names=[],current=null,running=false,times={},lastUpdate=Date.now();
  var engineTimer=null,uiTimer=null;

  function getCenter(){return {x:scene.clientWidth/2,y:scene.clientHeight/2}}
  function getRingRadius(){return Math.min(scene.clientWidth,scene.clientHeight)*0.36}

  function updateNames(){
    names = (namesInput.value||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    var newTimes={}; names.forEach(n=>newTimes[n]=times[n]||0); times=newTimes;
    renderNames();
  }

  function renderNames(){
    namesCircle.innerHTML="";
    var c=getCenter(),R=getRingRadius();
    names.forEach((nm,i)=>{
      var angle=(i/names.length)*Math.PI*2-Math.PI/2;
      var x=c.x+R*Math.cos(angle), y=c.y+R*Math.sin(angle);
      var div=document.createElement("div");div.className="name-pill"+(nm===current?" name-active":"");div.textContent=nm;
      div.style.left=x+"px";div.style.top=y+"px";
      namesCircle.appendChild(div);
    });
  }

  function updateEveningAward(){
    var best="‚Äî",bestTime=0;
    names.forEach(nm=>{var t=times[nm]||0;if(nm===current&&running)t+=(Date.now()-lastUpdate)/1000;if(t>bestTime){bestTime=t;best=nm}});
    eveningAward.textContent="üèÜ –°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤–µ—á–µ—Ä–∞: "+best;
  }

  function startEngine(){
    if(engineTimer)return; lastUpdate=Date.now();
    engineTimer=setInterval(()=>{var now=Date.now(),dt=(now-lastUpdate)/1000;lastUpdate=now;if(running&&current){times[current]+=dt;}},100);
    uiTimer=setInterval(updateEveningAward,500);
  }
  function stopEngine(){clearInterval(engineTimer);engineTimer=null;clearInterval(uiTimer);uiTimer=null;}

  function onToggle(){
    if(!running){running=true;toggleBtn.textContent="–°—Ç–æ–ø";toggleBtn.className="stop";flame.style.display="block";current=names[0]||null;startEngine();}
    else{running=false;toggleBtn.textContent="–ü—É—Å–∫";toggleBtn.className="start";flame.style.display="none";stopEngine();updateEveningAward();}
  }
  function onReset(){
    running=false;flame.style.display="none";stopEngine();current=null;times={};smokeLabel.textContent="üî• –°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –Ω–∞ –∫–æ—Å—Ç—Ä–µ –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞";eveningAward.textContent="üèÜ –°–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤–µ—á–µ—Ä–∞: ‚Äî";renderNames();
  }

  // bind only pointerup OR click
  if(window.PointerEvent){toggleBtn.addEventListener("pointerup",onToggle);resetBtn.addEventListener("pointerup",onReset);}
  else{toggleBtn.addEventListener("click",onToggle);resetBtn.addEventListener("click",onReset);}

  namesInput.addEventListener("input",updateNames);
  window.addEventListener("load",updateNames);
})();
</script>
</body>
</html>
